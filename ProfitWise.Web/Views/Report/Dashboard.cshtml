@using ProfitWise.Data.Model
@{
    ViewBag.CommonContext.PageTitle = "ProfitWise Dashboard";
}

<!-- KnockoutJS Templates -->
@Html.Partial("~/Views/SharedTemplates/_PagingWidget.cshtml")
@Html.Partial("~/Views/Report/_ReportManager.cshtml")


<style>
    .daterangepicker {
        width: 720px !important;
        font-size: 13px !important;
    }
    div.calendar-table td {
        padding: 0px !important;
        line-height: 33px;
    }
    .modal-backdrop {
        z-index: 900;
    }    
    i.date-range-picker-icon {
        position: absolute; bottom: 10px; right: 10px; top: auto; cursor: pointer;
    }
</style>

<script type="text/html" id="Page-Header">
   
</script>


<!-- TODO: configure Report Manager to use this -->
<script type="text/html" id="Dashboard-Body">
    <img style="width: 100%;" src="@Url.Content("~/Content/images/ProfitabilityMockup.PNG")" />
</script>

<!-- KnockoutJS Root Element -->
<div data-bind="template: { name: 'Report-Manager-Top-Level' }"></div>


<!-- KnockoutJS Model -->
<script>
    var ProfitWise = ProfitWise || {};

    var OverallProfitabilityReportId = @PwSystemReportFactory.OverallProfitabilityId;

    ProfitWise.DashboardModel = function () {
        var self = this;

        // Report View Model configuration
        self.ReportManagerModel = new ProfitWiseWidgets.ReportManagerModel();   
        
        self.ReportManagerModel.SelectReportCallback = function (reportId) {
            console.log('Selected Report : ' + reportId);
            // TODO - add functionality for this
        };

        self.ReportManagerModel.EditReportCallback = function(reportId) {
        };
        
        // Report Editor Model configuration
        self.ReportEditorModel = new ProfitWiseWidgets.ReportEditorModel();        

        return self;
    };

    $(document)
        .ready(function () {
            ProfitWiseFunctions.FixedHeaderScrollingInit(".standard-header");
            ProfitWiseFunctions.PopOverAutoCloseInit();

            var model = new ProfitWise.DashboardModel();
            ko.applyBindings(model);

            flow.exec(
                function() {
                    model.ReportManagerModel.LoadReports(this);
                },
                function () {
                    model.ReportManagerModel.SelectReportByReportId(OverallProfitabilityReportId);
                }
            );
        });
</script>

