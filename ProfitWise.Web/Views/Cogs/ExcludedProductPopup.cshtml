@using ProfitWise.Web.Attributes
@model ProfitWise.Data.Model.Cogs.PwCogsProductSummary

@{
    Context.AuthenticatedContext().PageTitle = "Bulk Exclude/Include Variants";
    Layout = "~/Views/Shared/_DialogLayout.cshtml";
}


<script id="Main-Template" type="text/html">
    <h4 style="font-weight: 600;" data-bind="text: $data.ProductTitle"></h4>
    <p>Would you like to Include or Exclude all <span data-bind="text: VariantCount"></span> Variants?</p>

    <div style="height: 24px;"></div>
    <form class="form-inline">
        <div class="form-group">
            <a href="#" 
               data-bind="click: $root.IncludeAllProductVariants" 
               class="form-control btn btn-primary" 
               style="width: 48%;">
                <i class="glyphicon glyphicon-eye-open"></i> &nbsp; Include
            </a>
            <a href="#" 
               data-bind="click: $root.ExcludeAllProductVariants" 
               class="form-control btn btn-primary" 
               style="width: 48%;">
                <i class="glyphicon glyphicon-eye-close"></i> &nbsp; Exclude
            </a>
        </div>
    </form>
</script>

<div data-bind="template: { name: 'Main-Template' }">
</div>

<script>
    var pwMasterProductId = @Model.PwMasterProductId;
    var productTitle = '@Model.Title';
    var variantCount = @Model.Variants.Count;

    $(document)
        .ready(function () {
            var ProfitWise = ProfitWise || {};

            ProfitWise.ExcludedModel = function() {
                var self = this;

                self.PwMasterProductId = ko.observable();
                self.ProductTitle = ko.observable();
                self.VariantCount = ko.observable();
                self.IncludeAllProductVariants = function() {
                    self.UpdateServer(false);

                };

                self.ExcludeAllProductVariants = function() {
                    self.UpdateServer(true);
                };

                
                self.UpdateServer = function(value) {
                    var settings = new ProfitWiseFunctions.AjaxSettings(true);
                    var ajax = new ProfitWiseFunctions.Ajax(settings);
                    var data = {
                        pwMasterProductId: self.PwMasterProductId(),
                        value: value,
                    };

                    ajax.HttpPost("/CogsService/ExcludeByMasterProductId", data,
                        function() {
                            ProfitWiseShopify.CloseModal({ result: true });
                        });
                }
            };


            var model = new ProfitWise.ExcludedModel();
            model.ProductTitle(productTitle);
            model.VariantCount(variantCount);
            model.PwMasterProductId(pwMasterProductId);
            ko.applyBindings(model);
            window.ModelHandle = model;
        });
</script>
   
